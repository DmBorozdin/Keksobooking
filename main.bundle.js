(()=>{var e={666:()=>{const e=document.querySelector(".ad-form-header__input"),t=document.querySelector(".ad-form-header__preview img"),o=document.querySelector(".ad-form__input"),r=document.querySelector(".ad-form__photo"),n=["gif","jpg","jpeg","png"],c=(e,t)=>{const o=e.files[0],r=o.name.toLowerCase();if(n.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{t.src=e.result})),e.readAsDataURL(o)}};e.addEventListener("change",(()=>{c(e,t)})),o.addEventListener("change",(()=>{r.innerHTML="";const e=document.createElement("img");e.alt="Фотография квартиры",e.style.height="70px",c(o,e),r.appendChild(e)}))}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var c=t[r]={exports:{}};return e[r](c,c.exports,o),c.exports}(()=>{"use strict";const e=document.querySelector("#card").content.querySelector(".popup"),t=e=>""!==e&&void 0!==e,r=e=>0!==e&&void 0!==e,n=e=>e.length&&void 0!==e,c=o=>{const c=e.cloneNode(!0);if(t(o.offer.title)?c.querySelector(".popup__title").textContent=o.offer.title:c.querySelector(".popup__title").style.display="none",t(o.offer.address)?c.querySelector(".popup__text--address").textContent=o.offer.address:c.querySelector(".popup__text--address").style.display="none",r(o.offer.price)?c.querySelector(".popup__text--price").innerHTML=`${o.offer.price} <span>₽/ночь</span>`:c.querySelector(".popup__text--price").style.display="none",t(o.offer.type))switch(o.offer.type){case"palace":c.querySelector(".popup__type").textContent="Дворец";break;case"flat":c.querySelector(".popup__type").textContent="Квартира";break;case"house":c.querySelector(".popup__type").textContent="Дом";break;case"bungalow":c.querySelector(".popup__type").textContent="Бунгало"}else c.querySelector(".popup__type").style.display="none";let a="";r(o.offer.rooms)&&(a=`${o.offer.rooms} комнаты`),r(o.offer.guests)&&(a+=` для ${o.offer.guests} гостей`),t(a)?c.querySelector(".popup__text--capacity").textContent=a:c.querySelector(".popup__text--capacity").style.display="none";let s="";if(t(o.offer.checkin)&&t(o.offer.checkout)?s=`Заезд после ${o.offer.checkin}, выезд до ${o.offer.checkout}`:(t(o.offer.checkin)&&(s=`Заезд после ${o.offer.checkin}`),t(o.offer.checkout)&&(s=`Выезд до ${o.offer.checkout}`)),t(s)?c.querySelector(".popup__text--time").textContent=s:c.querySelector(".popup__text--time").style.display="none",n(o.offer.features))for(let e=c.querySelector(".popup__features").children.length-1;e>=0;e--){const t=c.querySelector(".popup__features").children[e];o.offer.features.includes(t.classList[1].slice(16))||t.remove()}else c.querySelector(".popup__features").style.display="none";if(t(o.offer.description)?c.querySelector(".popup__description").textContent=o.offer.description:c.querySelector(".popup__description").style.display="none",n(o.offer.photos)){if(c.querySelector(".popup__photo").src=o.offer.photos[0],o.offer.photos.length>1)for(let e=1;e<o.offer.photos.length;e++){const t=c.querySelector(".popup__photo").cloneNode(!1);t.src=o.offer.photos[e],c.querySelector(".popup__photos").appendChild(t)}}else c.querySelector(".popup__photos").style.display="none";return t(o.author.avatar)?c.querySelector(".popup__avatar").src=o.author.avatar:c.querySelector(".popup__avatar").style.display="none",c},a=document.querySelector(".map__filters"),s=a.children,l=document.querySelector(".ad-form"),i=l.querySelectorAll("fieldset"),d=l.querySelector("#type"),p=l.querySelector("#price"),u=l.querySelector("#timein"),f=l.querySelector("#timeout"),y=l.querySelector("#address"),h=l.querySelector("#room_number"),m=l.querySelector("#capacity"),g=l.querySelector(".ad-form__reset"),v=m.querySelectorAll("option"),S=document.querySelector("#error").content.querySelector(".error"),q=document.querySelector("#success").content.querySelector(".success"),x=document.querySelector("main"),k=0,w=1e3,b=5e3,E=1e4,I="0",C=()=>{m.options.length=0;for(let e=0;e<v.length;e++)(v[e].value<=h.options[h.selectedIndex].value&&v[e].value!==I&&"100"!==h.options[h.selectedIndex].value||"100"===h.options[h.selectedIndex].value&&v[e].value===I)&&(m[m.length]=new Option(v[e].textContent,v[e].value))};let P=null,$=null;const M=e=>{(e=>"Escape"===e.key||"Esc"===e.key)(e)&&(e.preventDefault(),document.querySelector(".success")&&P(),document.querySelector(".error")&&$())};P=()=>{x.querySelector(".success").remove(),document.removeEventListener("keydown",M)},$=()=>{x.querySelector(".error").remove(),document.removeEventListener("keydown",M)};const j=e=>{l.reset(),p.placeholder=w,p.min=w,C(),e()};l.classList.add("ad-form--disabled");for(const e of i)e.disabled=!0;y.readOnly=!0,d.addEventListener("change",(()=>{switch(d.options[d.selectedIndex].value){case"bungalow":p.placeholder=k,p.min=k;break;case"flat":p.placeholder=w,p.min=w;break;case"house":p.placeholder=b,p.min=b;break;case"palace":p.placeholder=E,p.min=E}})),window.addEventListener("load",(()=>C())),h.addEventListener("change",(()=>C())),u.addEventListener("change",(()=>f.selectedIndex=u.selectedIndex)),f.addEventListener("change",(()=>u.selectedIndex=f.selectedIndex));const z=document.querySelector(".ad-form"),A=z.querySelectorAll("fieldset"),T=z.querySelector("#address"),F=document.querySelector(".map__filters"),N=F.children,O=F.querySelector("#housing-type"),V=F.querySelector("#housing-rooms"),D=F.querySelector("#housing-price"),U=F.querySelector("#housing-guests"),H=F.querySelectorAll(".map__checkbox"),R={mapView:{lat:35.85,lng:139.785,zoom:9},mainPinMarker:{lat:35.6634,lng:139.77321},mainPinIcon:{width:52,height:52},pinIcon:{width:40,height:40},adsCount:10,price:{low:1e4,high:5e4}},G=L.layerGroup([]);let W=0;const B=[],J=()=>{T.value=`${R.mainPinMarker.lat.toFixed(5)}, ${R.mainPinMarker.lng.toFixed(5)}`};F.classList.add("map__filters--disabled");for(const e of N)e.disabled=!0;const K=L.map("map-canvas").on("load",(()=>{z.classList.remove("ad-form--disabled");for(const e of A)e.disabled=!1;F.classList.remove("map__filters--disabled");for(const e of N)e.disabled=!1;J()})).setView({lat:R.mapView.lat,lng:R.mapView.lng},R.mapView.zoom);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(K);const Q=L.icon({iconUrl:"./img/main-pin.svg",iconSize:[R.mainPinIcon.width,R.mainPinIcon.height],iconAnchor:[R.mainPinIcon.width/2,R.mainPinIcon.height]}),X=L.marker({lat:R.mainPinMarker.lat,lng:R.mainPinMarker.lng},{draggable:!0,icon:Q});X.addTo(K),X.on("moveend",(e=>{T.value=`${e.target.getLatLng().lat.toFixed(5)}, ${e.target.getLatLng().lng.toFixed(5)}`}));const Y=()=>{X.setLatLng([R.mainPinMarker.lat,R.mainPinMarker.lng]),J()},Z=e=>(e=>{let t=0;switch(e.offer.type===O.options[O.selectedIndex].value&&t++,e.offer.rooms===Number(V.options[V.selectedIndex].value)&&t++,D.options[D.selectedIndex].value){case"middle":e.offer.price<=R.price.high&&e.offer.price>=R.price.low&&t++;break;case"low":e.offer.price<R.price.low&&t++;break;case"high":e.offer.price>R.price.high&&t++}return e.offer.guests===Number(U.options[U.selectedIndex].value)&&t++,e.offer.features.forEach((e=>{B.includes(e)&&t++})),t})(e)===W||0===W,ee=(e,t)=>{G.clearLayers(),e.slice().filter(Z).slice(0,R.adsCount).forEach((e=>{const o=L.icon({iconUrl:"./img/pin.svg",iconSize:[R.pinIcon.width,R.pinIcon.height],iconAnchor:[R.pinIcon.width/2,R.pinIcon.height]}),r=L.marker({lat:e.location.lat,lng:e.location.lng},{icon:o});r.bindPopup(t(e),{keepInView:!0}),G.addLayer(r)})),G.addTo(K)},te={type:0,price:0,rooms:0,guests:0,features:0,wifi:0,dishwasher:0,parking:0,washer:0,elevator:0,conditioner:0},oe=()=>{W=Object.values(te).reduce(((e,t)=>e+t),0)};var re;o(666),re=e=>{var t;ee(e,c),t=_.debounce((()=>ee(e,c)),500),O.addEventListener("change",(()=>{te.type=0!==O.selectedIndex?1:0,oe(),t()})),V.addEventListener("change",(()=>{te.rooms=0!==V.selectedIndex?1:0,oe(),t()})),D.addEventListener("change",(()=>{te.price=0!==D.selectedIndex?1:0,oe(),t()})),U.addEventListener("change",(()=>{te.guests=0!==U.selectedIndex?1:0,oe(),t()})),H.forEach((e=>{e.addEventListener("change",(()=>{e.checked?(te.features++,B.push(e.value)):(te.features--,B.splice(B.indexOf(e.value),1)),oe(),t()}))}))},fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json()})).then((e=>{re(e)})).catch((()=>{(e=>{const t=document.createElement("div"),o=document.createElement("p");t.style.zIndex=1100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.width="100%",t.style.height="100%",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.backgroundColor="rgba(0, 0, 0, 0.8)",o.textContent="Ошибка загрузки объявлений",o.style.color="#fff",o.style.fontSize="30px",t.appendChild(o),document.querySelector(".map").appendChild(t),setTimeout((()=>{t.remove()}),3e3)})(),a.classList.add("map__filters--disabled");for(const e of s)e.disabled=!0})),(e=>{l.addEventListener("submit",(t=>{var o,r,n;t.preventDefault(),o=()=>(e=>{x.appendChild(q.cloneNode(!0)),document.addEventListener("keydown",M),document.querySelector(".success").addEventListener("click",P),j(e)})(e),r=()=>(x.appendChild(S.cloneNode(!0)),document.addEventListener("keydown",M),void document.querySelector(".error").addEventListener("click",$)),n=new FormData(t.target),fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:n}).then((e=>{e.ok?o():r()})).catch((()=>{r()}))}))})(Y),(e=>{g.addEventListener("click",(t=>{t.preventDefault(),j(e)}))})(Y)})()})();
//# sourceMappingURL=main.bundle.js.map